---
title: "Final Project: Analyzing Suicide Mortality Trends by Demographic Factors"
author: "by Joseph Kim and Jun Tianzhong"
date: "`r Sys.Date()`"
output: pdf_document
editor_options: 
  markdown: 
    wrap: 72
---

![Suicide Rate by County in the United States in
2016.](SuicideRatebyCounty.png){#id .class width="100%" height="100%"
style="display: block; margin: 0 auto;"}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
install.packages("tidyverse", repos = "http://cran.us.r-project.org")
install.packages("lme4", repos = "http://cran.us.r-project.org")
install.packages("Matrix", dependencies = T, repos = "http://cran.us.r-project.org")
library(tidyverse)
library(dplyr)
library(lme4)
```

\newpage

# Abstract

# Introduction

|     Understanding the dynamics of suicide rates across demographic categories is paramount in addressing the complexities of mental health and societal well-being. Over the decades, the United States has witnessed fluctuations in suicide rates (increased trend), influenced by a multitude of factors including societal changes, economic conditions, and mental health awareness. The exploration of these trends sheds light on the historical patterns of suicide but also guides targeted interventions and awareness to mitigate risk factors associated with suicide.

|     Recent years we have seen a growing recognition of the urgency to address mental health issues, including suicide prevention, at both the nation and global level. With increasing awareness, there has been an increase in research efforts aimed to dissecting the interrelationship between demographic variables and suicide rates.This includes the examination of disparities across sex, race, Hispanic origin, and age groups, acknowledging the nuanced experiences and demographic categories that are the most vulnerable.

|     With a data set provided by the U.S. Department of Health & Human Services titled "Death rates for suicide, by sex, race, Hispanic origin, and age: United States", this study seeks to contribute to this ongoing research by comprehensively analyzing death rates for suicide in the United States spanning nearly seven decades, from 1950 to 2018. By analyzing into historical data, we aim to discern long-term trends and identify significant shifts in suicide rates among different demographic groups. Moreover, we want to uncover potential underlying factors contributing to these trends, informing targeted interventions and policy initiatives tailored to address the unique needs of diverse populations like the United States. In essence, we aspire to contribute towards fostering a society that has increased mental health awareness through this research.

# Data Analysis

```{r}
data <- read_csv("Dataset/deathRates.csv", show_col_types = F)
demoCategory <- unique(data$STUB_LABEL)
ages <- unique(data$AGE)
years <- unique(data$YEAR)
demoFactor <- unique(data$STUB_NAME)

summaryDeathRate <- data %>%
  filter(STUB_NAME %in% demoFactor[1])

deathRate.summary <- ggplot(summaryDeathRate, aes(x = YEAR, y = ESTIMATE)) +
  geom_line() +
  labs(x = "Year", y = "Deaths per 100,000 Resident Population") +
  ggtitle("Death Rate Summary")

ggsave("deathSummary.pdf", deathRate.summary)

srDeathRate <- data %>% 
  filter(STUB_NAME %in% demoFactor[3])

deathRate.sexRace <- ggplot(srDeathRate, aes(x = STUB_LABEL, y = ESTIMATE)) +
  geom_bar(stat = "identity") +
  scale_x_discrete(labels = function(x) gsub(" ", "\n", x)) +
  labs(x = "Sex-Race", y = "Deaths per 100,000 Resident Population") +
  ggtitle("Cumulative Death Count")

ggsave("CumulativeDeath.pdf", deathRate.sexRace)

srhDeathRate <- data %>% 
  filter(STUB_NAME %in% demoFactor[4])

ageDeathRate <- data %>%
  filter(STUB_NAME %in% demoFactor[10])

hispanicOrigin<- c("Female: Hispanic or Latino: All races","Male: Hispanic or Latino: All races")
HispanicMaleDeathRate <- srhDeathRate %>%
  filter(STUB_LABEL %in% hispanicOrigin[2]) 
HispanicFemaleDeathRate <- srhDeathRate %>% 
  filter(STUB_LABEL %in% hispanicOrigin[1])

deathRate.hispanic <- ggplot() +
  geom_line(data = HispanicMaleDeathRate, aes(x = YEAR, y = ESTIMATE, color = "Male")) +
  geom_line(data = HispanicFemaleDeathRate, aes(x = YEAR, y = ESTIMATE, color = "Female")) +
  labs(x = "Year", y = "Deaths per 100,000 Resident Population") +
  ggtitle("Death Rate of Hispanic Origin")

ggsave("HispanicDeath.pdf", deathRate.hispanic)


nonHispanicDeathRate <- srhDeathRate %>%
  filter(!(STUB_LABEL %in% hispanicOrigin))

deathRate.nonHispanic <- ggplot(nonHispanicDeathRate, aes(x = STUB_LABEL, y = ESTIMATE)) +
  geom_bar(stat = "identity") +
  scale_x_discrete(labels = function(x) gsub(" ", "\n", x)) +
  labs(x = "Sex-Race", y = "Deaths per 100,000 Resident Population") +
  ggtitle("Non-Hispanic Origin: Cumulative Death Count")

ggsave("NonHispanicDeath.pdf", deathRate.nonHispanic)

deathRate.age <- ggplot(ageDeathRate, aes(x = AGE, y = ESTIMATE)) +
  geom_bar(stat = "identity") +
  scale_x_discrete(labels = function(x) gsub(" ", "\n", x)) +
  labs(x = "Age", y = "Deaths per 100,000 Resident Population") +
  ggtitle("Cumulative Deaths Count by Age Groups")

ggsave("ageDeath.pdf", deathRate.age)
```

```{r}
sexDeathRate <- data %>%
  filter(STUB_NAME %in% demoFactor[2])
male_death_rates <- sexDeathRate %>%
  filter(STUB_LABEL == "Male")
female_death_rates <- sexDeathRate %>%
  filter(STUB_LABEL == "Female")

sex_death_rate_plot <- ggplot() +
  geom_line(data = male_death_rates, aes(x = YEAR, y = ESTIMATE, color = "Male")) +
  geom_line(data = female_death_rates, aes(x = YEAR, y = ESTIMATE, color = "Female")) +
  labs(x = "Year", y = "Deaths per 100,000 resident population", color = "Sex") +
  ggtitle("Male vs Female Death Rates from Suicide (1960-2018)") +
  scale_color_manual(values = c("blue", "red")) + 
  theme_minimal()

ggsave("deathByGender.pdf", sex_death_rate_plot)
```

```{r}
df <- data.frame(age = character(), race = character(), hispanic_origin = character(), sex = character(), death = numeric())

for (i in 1:nrow(ageDeathRate)) {
  row <- ageDeathRate[i, ]
  df[i, "age"] <- row$AGE
  string <- row$STUB_LABEL
  split <- strsplit(string, ":")
  df[i, "sex"] <- trimws(split[[1]][1])
  df[i, "race"] <- trimws(split[[1]][3])
  df[i, "hispanic_origin"] <- trimws(split[[1]][2])
  df[i, "death"] <- row$ESTIMATE
}
```

```{r}
anova_result <- aov(death ~ age + race + hispanic_origin + sex, data = df)
summary(anova_result)
```
```{r}
df_numeric <- df %>%
  mutate_if(is.character, as.factor) %>%
  mutate_all(as.numeric)
correlation_matrix <- cor(select(df_numeric, -death))
correlation_matrix
```
```{r}
ggplot(df, aes(x = race, y = death, fill = race)) +
  geom_boxplot() +
    scale_x_discrete(labels = function(x) stringr::str_wrap(x, width = 3))

ggplot(df, aes(x = race, y = death, fill = age)) +
  geom_boxplot() +
  scale_x_discrete(labels = function(x) stringr::str_wrap(x, width = 10))


```

```{r}
df <- na.omit(df)
longitudinal_model <- lmer(death ~ age + sex + race + (1 | age) + (1 | sex) + (1 | race), data = df)
summary(longitudinal_model)
```

```{r}
races_count <- table(interaction(df$race, df$sex, df$age))
group_df <- df %>%
  group_by(sex, age, race, hispanic_origin) %>% 
  summarise(
    mean_death = mean(death, na.rm = T),
    variance_death = var(death, na.rm = T)
  )
#based on 2022 US census data
#22.68 mil / 100k = 226.8 -> male 15-24
#21.65 mil / 100k = 216.5 -> female 15-24
#45.31 mil / 100k = 453.1 -> male 25-44
#43.89 mil / 100k = 438.9 -> female 25-44
#40.94 mil / 100k = 409.4 -> male 45-64
#41.57 mil / 100k = 415.7 -> female 45-64
#26.03 mil / 100k = 260.3 -> male 65+
#31.86 mil / 100k = 318.6 -> female 65+
population_counts <- list(allRaces15.Female = 217, americanIndian15.Female = 102, asian15.Female = 121, black15.Female = 128, white15.Female = 217, allRaces25.Female = 439, americanIndian25.Female = 258, asian25.Female = 258, black25.Female = 258, white25.Female = 439, allRaces45.Female = 416, americanIndian45.Female = 110, asian45.Female = 245, black45.Female = 245, white45.Female = 245, allRaces65.Female = 319, asian65.Female = 319, black65.Female = 223, white65.Female = 542, allRaces15.Male = 227, americanIndian15.Male = 134, asian15.Male = 134, black15.Male = 134, white15.Male = 227, allRaces25.Male = 453, americanIndian25.Male = 266, asian25.Male = 266, black25.Male = 266, white25.Male = 453, allRaces45.Male = 409, americanIndian45.Male = 241, asian45.Male = 241, black45.Male = 241, white45.Male = 409,  allRaces65.Male = 260, americanIndian65.Male = 31, asian65.Male = 153, black65.Male = 153, white65.Male = 260
)

for (i in 1:nrow(group_df)) {
  group_df$population_augment[i] <- population_counts[i]
}

augment_df <- data.frame(
  age = character(),
  race = character(),
  hispanic_origin = character(),
  sex = character(),
  death = numeric()
)

for (i in 1:nrow(group_df)) {
  count <- group_df$population_augment[[i]]
  count
  for (j in 1:count) {
    augment_df <- rbind(augment_df, data.frame(
      age = group_df$age[i],
      race = group_df$race[i],
      hispanic_origin = group_df$hispanic_origin[i],
      sex = group_df$sex[i],
      death = rnorm(1, mean = group_df$mean_death[i], sd = sqrt(group_df$variance_death[i]))
    ))
  }
}
```

```{r}
predicted <- predict(longitudinal_model, newdata = augment_df)
observed <- df$death
n_points <- length(observed)
randomSelectPredict <- predicted[sample(length(predicted), n_points)]

predicted_observed <- data.frame(Predicted = randomSelectPredict, Observed = observed)

ggplot(predicted_observed, aes(x = Predicted, y = Observed)) +
  geom_point(aes(color = "Observed"), shape = 12) +
  geom_point(aes(color = "Predicted"), shape = 2) +
  geom_smooth(method = "lm", se = T, color = "blue") +  # Add this line
  labs(x = "Predicted", y = "Observed", title = "Predicted vs Observed Plot")



plot(longitudinal_model, which = 2)
conditional_plot <- ggpredict(longitudinal_model, terms = c("age", "race"))


```


# Conclusion

# Team Contribution Statement
